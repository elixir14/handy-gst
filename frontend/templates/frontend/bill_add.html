{% extends 'frontend/base.html' %}

{% block title %}Invoice{% endblock %}

{% block javascript %}

<script type="text/javascript">

    // To fill company details

    $("#id_brand_select").change(function () {
        $company_id = $(this).val();
        $.ajax({
            url: 'company_detail/',
            data: {
              'company_id': $company_id
            },
            dataType: 'json',
            success: function (data) {
              if (data.results) {
               // console.log(data.results);
                $("#id_gst").attr("value", data.results.gst);
                $("#id_account_number").attr("value", data.results.account_number);
                $("#id_ifsc").attr("value", data.results.ifsc);
                $("#id_pan").attr("value", data.results.pan);
                $("#id_remarks").attr("value", data.results.remarks);
                $("#id_terms").attr("value", data.results.terms);
                $("#id_authorised_signatory").attr("value", data.results.authorised_signatory);
                $("#id_car_select").empty();
                id_car_select = document.getElementById("id_car_select");
                for (index in data.results.clients) {
                        client = data.results.clients[index]
                       // alert(client.value);
                        id_car_select.options.add(new Option(client.value,client.id))
                    }
              }
            }
        });
    });

    // To fill client details

    $("#id_car_select").change(function () {
        $client_id = $(this).val();
        $.ajax({
            url: 'client_detail/',
            data: {
              'client_id': $client_id
            },
            dataType: 'json',
            success: function (data) {
              if (data.results) {
                console.log(data.results);
                $("#id_recipient").attr("value", data.results.recipient);
                $("#id_billing_address").attr("value", data.results.consignee);

              }
            }
        });
    });


     function Test()
     {
        var count = parseInt($("#id_item_set-TOTAL_FORMS").val());
        var total = 0.00;
        for (i = 0; i < count; i++) {
            var rate = parseFloat($("#id_item_set-" + i + "-rate").val());
            var quantity = parseFloat($("#id_item_set-" + i + "-quantity").val());
            rate = rate || 0.00;
            quantity = quantity || 0.00;
            var value = rate*quantity;
            $("#id_item_set-" + i + "-value").val(value);
            var discount = parseFloat($("#id_item_set-" + i + "-discount").val());
            discount = discount || 0.00;
            if (discount > 100)
             {
                discount = 100;
             }
             taxable_value = value
            if (discount > 0)
            {
                taxable_value = value*(100-discount)/100;
            }
            $("#id_item_set-" + i + "-quantity_code").val(taxable_value);
            total = total + taxable_value;
        }
        $("#id_item_set-0-hsn_code").val(total);
     }
</script>
{% endblock %}

{% block content %}
<div id="page-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Generate Bill</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <form method="post">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-12">
                                    {{ form.as_p }}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                <table class="table">
                                    {{ items.management_form }}

                                    {% for form in items.forms %}
                                        {% if forloop.first %}
                                            <thead>
                                            <tr>
                                                {% for field in form.visible_fields %}
                                                    <th>{{ field.label|capfirst }}</th>
                                                {% endfor %}
                                            </tr>
                                            </thead>
                                        {% endif %}
                                        <tr class="{% cycle row1 row2 %} formset_row">
                                            {% for field in form.visible_fields %}
                                                <td>
                                                    {# Include the hidden fields in the form #}
                                                    {% if forloop.first %}
                                                        {% for hidden in form.hidden_fields %}
                                                            {{ hidden }}
                                                        {% endfor %}
                                                    {% endif %}
                                                    {{ field.errors.as_ul }}
                                                    {{ field }}
                                                </td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </table>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-3">
                                    <button type="submit" class="btn btn-block btn-info btn-fill pull-right">
                                        Generate
                                    </button>
                                </div>
                            </div>

                        </form>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</div>
{%endblock%}
